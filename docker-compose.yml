version: "3"
services:

  db:
    image: postgres:11-alpine
    environment:
      POSTGRES_PASSWORD: .admin1
      POSTGRES_USER: postgres
    restart: unless-stopped
    ports:
      - "5434:5432"
    volumes:
      - intrexx-db-data:/var/lib/postgresql/data


  solr:
    image: solr:8.4.1
    environment:
      # https://github.com/apache/lucene-solr/blob/master/solr/docker/Docker-FAQ.md
      SOLR_OPTS: -XX:-UseLargePages
    restart: unless-stopped
    ports:
     - "8984:8983"
     - "9984:9983"
    command: -c
    volumes:
     - intrexx-solr-data:/var/solr


  intrexx:
    image: unitedplanet/intrexx:21.03-latest
    depends_on:
      - db
      - solr
    environment:
      DB_HOST: db
      SOLR_HOST: solr
      SOLR_SASL_DISABLED: "true"
      PORTAL_NAME: portal
      PORTAL_ZIP_NAME: portal-template.zip
      PORTAL_ZIP_MNTPT: /opt/intrexx/org
      DB_NAME: ixportal
      DB_USER: postgres
      DB_PASSWORD: .admin1
    restart: unless-stopped
    ports:
      - "1337:1337"
      - "8101:8101"
      - "9090:9090"
    volumes:
      - portal-data:/opt/intrexx/org

  # nginx:
  #   depends_on:
  #     - intrexx
  #   image: nginx:1.19
  #   restart: unless-stopped
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - ./resource/nginx/conf.d:/etc/nginx/conf.d:ro
  #     - ./resource/nginx/ssl/example.unitedplanet.de:/etc/ssl/example.unitedplanet.de:ro
  #     - portal-data:/opt/intrexx/org


volumes:
  portal-data:
  intrexx-db-data:
  intrexx-solr-data:
